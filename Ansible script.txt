hosts: qa
  vars:
    date: "{{ lookup('pipe', 'date +%Y%m%d-%H%M') }}"
  tasks:
   - name: Taking the test.war file backup into /home/centosuser/apps/backup
     copy: src=/home/centosuser/apps/softwares/jboss-4.2.3.GA/server/test/deploy/test.war dest=/home/centosuser/apps/backup/test-{{ date }}.war remote_src=yes

   - name: Copying the webapp file into the jboss server
     copy: src={{item}} dest=/home/centosuser/apps/softwares/jboss-4.2.3.GA/server/test/deploy/test.war mode=0664
     with_fileglob: "/var/lib/jenkins/workspace/test/webapp/target/webapp-0.5*.war"

   - name: restarting the jboss server
     shell: chdir=/home/centosuser/apps/softwares/jboss-4.2.3.GA/bin/ ./test_jboss restart
